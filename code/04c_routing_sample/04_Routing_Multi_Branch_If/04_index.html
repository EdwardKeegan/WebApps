<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Building a simple router</title>
    </head>
    <body>

        <div style ="background-color: #DDDDDD; padding: 1ex;">

            <p>
                This is the simplest example of routing. We are using internal links 
                (the href attribute starts with # so it stays on the page, does not The functional improvement with this code 
                is that you actually see the page links in the address bar and 
                the user can use the browser's back and forward buttons. To test out the functionality, 
                click the links below this grey area and see each link showing in the address bar 
                as the "fake" content changes (below the links).
            </p>
            <p>
                With this code, we simply:
            </p>
            <ul>
                <li>
                    Declare a global array (routes) with key/value pairs that define all the desired
                    link/content associations. 
                </li>
                <li>
                    Define a simple router function that places the desired content on the page, based 
                    on the value of the active link (window.location.hash).
                </li>
                <li>
                    Then we add an event handler that invokes function 'router' whenever the active link changes. 
                    <br/>
                    <pre>
    window.addEventListener('hashchange', router);
                    </pre>
                </li>
                <li>
                    This line of code injects the page with home content upon initial page load. We set the 
                    hash to a dummy value before setting it to the desired home content - just to ensure that there 
                    is a change to the location.hash upon page refresh (this avoids the occasional empty content upon
                    page refresh).
                    <br/>
                    <pre>
    window.location.hash = '/home';
                    </pre>
                </li>
            </ul>

        </div>

        <br/>
        <br/>
        <a href="#/home">Home</a> |
        <a href="#/blog">Blog</a> |
        <a href="#/missing">Missing Link</a>
        <br/>
        <br/>

        <!-- Note: the JavaScript code expects there to be a DOM object with id "view" -->
        <!-- This is where the content is placed. -->
        <div id="view"></div>

        <script src="js/components/home.js"></script>
        <script src="js/components/blog.js"></script>
        <script src="js/components/missingLink.js"></script>

        <script>

            "use strict";

            function inject (what) {
                document.getElementById("view").innerHTML = "";
                document.getElementById("view").appendChild(what);
            }

            function router () {

                var newLink = window.location.hash;
                console.log("newLink is " + newLink);

                if (newLink === "#/home") {
                    inject(home());
                } else if (newLink === "#/blog") {
                    inject(blog());
                } else {
                    inject(missingLink());
                }
            }

            // Listen on hash change (whenever a link is clicked)
            // In other words, whenever a link is clicked, invoke function router.
            window.addEventListener('hashchange', router);

            // invoke an invalid content/link so that the next line will definitely change location.hash
            // otherwise sometimes with refresh you do not see the home content
            window.location.hash = '/xxx';

            // content for when page is first rendered.
            window.location.hash = '#/home';
        </script>
    </body>
</html>
